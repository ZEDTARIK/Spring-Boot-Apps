# Contact API (Spring Boot)

A minimal RESTful API to manage contacts with image upload support. Built with Spring Boot 3, Java 21, and Maven. Uses an in-memory H2 database for persistence and stores uploaded images on the local filesystem.

## Overview
- Stack: Java 21, Spring Boot 3.5.x (Web, Data JPA), H2 (in-memory), Lombok
- Package manager/build: Maven (wrapper included: `mvnw`, `mvnw.cmd`)
- Entry point: `src/main/java/com/ettarak/Application.java`
- REST endpoints are exposed under the base path `/contacts`
- Images are saved under `${user.home}/Downloads/uploads/` by default

## Requirements
- Java 21 (JDK 21)
- No need to install Maven globally (Maven Wrapper is included)

## Setup & Run

### 1) Clone and enter the project
```
# Windows PowerShell
cd C:\Users\ZouhairET-TARAK\Desktop\Projects_Net\java\ContactApi20251111
```

### 2) Run the application (dev)
```
# Windows
mvnw.cmd spring-boot:run

# macOS/Linux
./mvnw spring-boot:run
```
The app starts on `http://localhost:8080`.

H2 Console: `http://localhost:8080/h2-console` (default JDBC URL: `jdbc:h2:mem:db`, user: `sa`, empty password)

### 3) Build a jar
```
# Windows
mvnw.cmd -DskipTests package

# macOS/Linux
./mvnw -DskipTests package
```
The jar will be generated at `target/ContactApi20251111-0.0.1-SNAPSHOT.jar`.

### 4) Run the jar
```
java -jar target/ContactApi20251111-0.0.1-SNAPSHOT.jar
```

## API Endpoints
Base URL: `http://localhost:8080`

- GET `/contacts`
  - Query params: `page` (default 0), `size` (default 10)
  - Response body (JSON):
    - `content`: list of contacts
    - `currentPage`, `totalItems`, `totalPages`

- GET `/contacts/{id}`
  - Returns a single contact by id.

- POST `/contacts`
  - Creates a contact.
  - Request body (JSON):
    ```json
    {
      "name": "John",
      "email": "john@email.fr",
      "phone": "0123456789",
      "address": "USA"
    }
    ```
  - Response: 201 Created with Location header `/contacts/{id}`

- PUT `/contacts/photo`
  - Uploads/replaces a contact's photo.
  - Multipart form-data fields: `id` (string), `file` (image file)
  - Returns the absolute image URL.

- GET `/contacts/image/{filename}`
  - Returns the raw image bytes; `Content-Type` inferred from file.

### Example requests (curl)
```
# List contacts
curl "http://localhost:8080/contacts?page=0&size=5"

# Create a contact
curl -X POST "http://localhost:8080/contacts" \
  -H "Content-Type: application/json" \
  -d '{"name":"Jane","email":"jane@example.com","phone":"123456","address":"FR"}'

# Get a contact by id
curl "http://localhost:8080/contacts/{id}"

# Upload a photo
curl -X PUT "http://localhost:8080/contacts/photo" \
  -F id={id} \
  -F file=@/path/to/image.png

# Fetch an image
curl -v "http://localhost:8080/contacts/image/{filename}"
```

## Configuration & Environment Variables
Configuration file: `src/main/resources/application.yml`

Defaults:
```
server.port: 8080
spring.datasource.url: jdbc:h2:mem:db
spring.datasource.username: sa
spring.datasource.password: ""
spring.h2.console.enabled: true
spring.servlet.multipart.enabled: true
spring.servlet.multipart.max-file-size: 100MB
spring.servlet.multipart.max-request-size: 100MB
```

File storage directory (for uploaded images):
- Defined in `com.ettarak.constant.Constant.PHOTO_DIRECTORY`
- Default: `${user.home}/Downloads/uploads/`
  - On Windows, this may resolve like `C:\Users\<User>\Downloads\uploads\`

You can override Spring properties using environment variables (Spring Boot standard mapping), for example:
- `SERVER_PORT=9090` to run on port 9090
- `SPRING_DATASOURCE_URL=jdbc:h2:mem:other` to change DB URL
- Multipart limits can be adjusted: `SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE=25MB`

## Data Model
`com.ettarak.entities.Contact` (Lombok `@Builder` and standard fields):
- `id` (String, generated by Spring Data JPA)
- `name`, `email`, `phone`, `address`
- `photoUrl` (set after uploading an image)

## Behavior Notes
- On startup, two sample contacts are inserted via a `CommandLineRunner` in `Application`.
- Uploaded image filenames are derived from the contact id and the provided file's extension; if none, `.png` is used.
- Existing images with the same name are replaced (`REPLACE_EXISTING`).

## Scripts & Useful Commands
- Run app: `mvnw spring-boot:run` (Windows: `mvnw.cmd spring-boot:run`)
- Run tests: `mvnw test`
- Build jar: `mvnw -DskipTests package`
- Clean: `mvnw clean`

## Tests
- Test framework: Spring Boot Starter Test (JUnit Jupiter)
- Example test class scaffolded: `src/test/java/com/ettarak/ContactApi20251111ApplicationTests.java`
- Run all tests:
  - Windows: `mvnw.cmd test`
  - macOS/Linux: `./mvnw test`

## Project Structure
```
ContactApi20251111/
├─ pom.xml
├─ mvnw, mvnw.cmd
├─ README.md
├─ HELP.md
├─ src/
│  ├─ main/
│  │  ├─ java/com/ettarak/
│  │  │  ├─ Application.java                # Spring Boot entry point + sample data
│  │  │  ├─ constant/Constant.java          # Photo storage directory
│  │  │  ├─ entities/Contact.java           # Contact entity
│  │  │  ├─ exceptions/                     # Error handling types
│  │  │  │  ├─ GlobalExceptionHandler.java
│  │  │  │  └─ InvalidImageException.java
│  │  │  ├─ repositories/ContactRepository.java
│  │  │  ├─ resources/ContactResource.java  # REST controller
│  │  │  └─ services/ContactService.java    # Business logic and file upload
│  │  └─ resources/application.yml          # Spring config (H2, multipart, port)
│  └─ test/java/com/ettarak/ContactApi20251111ApplicationTests.java
└─ target/                                  # Build output (generated)
```

## Known Limitations / TODOs
- TODO: Add validation on `Contact` fields (email/phone formats).
- TODO: Add proper error responses documentation (problem details schema).
- TODO: Externalize `PHOTO_DIRECTORY` to configuration (`application.yml`) instead of a constant.
- TODO: Add integration tests for file upload and image retrieval.
- TODO: Persistence is in-memory (H2). Add a profile/env for a persistent DB (e.g., PostgreSQL/MySQL) if needed.
- TODO: Dockerfile and containerization instructions (not present).
- TODO: CI/CD pipeline configuration (not present).
- TODO: API documentation (OpenAPI/Swagger) is not configured.

## License
No license file is present in the repository. 
- TODO: Choose and add a license (e.g., MIT, Apache-2.0) and update this section accordingly.
